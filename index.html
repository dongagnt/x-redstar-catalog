<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalog Generator</title>
    <!-- Tailwind CSS CDN을 로드합니다. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter를 로드합니다. (Tailwind 기본 폰트) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Inter 폰트를 기본으로 설정합니다. */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body>
    <!-- React 앱이 마운트될 루트 엘리먼트입니다. -->
    <div id="root"></div>

    <!-- React 앱 코드를 로드하는 스크립트 태그입니다. -->
    <!-- type="module"을 사용하여 ES 모듈을 지원합니다. -->
    <script type="module">
        // 이 로그 메시지가 콘솔에 나타나면 스크립트가 실행되기 시작했음을 의미합니다.
        console.log("Script execution started in index.html.");

        // React 및 ReactDOM을 CDN에서 가져옵니다.
        import React, { useState } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';

        // lucide-react 아이콘 컴포넌트를 CDN에서 가져옵니다.
        // esm.sh를 통해 개별 아이콘을 직접 가져옵니다.
        import Plus from 'https://esm.sh/lucide-react@0.303.0/dist/esm/icons/plus';
        import Minus from 'https://esm.sh/lucide-react@0.303.0/dist/esm/icons/minus';
        import Upload from 'https://esm.sh/lucide-react@0.303.0/dist/esm/icons/upload';
        import Download from 'https://esm.sh/lucide-react@0.303.0/dist/esm/icons/download';


        // CatalogGenerator React 컴포넌트 (이전에 제공된 코드)
        const CatalogGenerator = () => {
          const [brandLogo, setBrandLogo] = useState(null);
          const [productName, setProductName] = useState('');
          const [modelName, setModelName] = useState('');
          const [productImage, setProductImage] = useState(null);
          const [layout, setLayout] = useState('vertical'); // 'vertical' or 'horizontal'
          const [backgroundColor, setBackgroundColor] = useState('#ff69b4'); // Hot pink color
          const [specifications, setSpecifications] = useState([
            { label: '', value: '' },
            { label: '', value: '' },
            { label: '', value: '' },
            { label: '', value: '' },
            { label: '', value: '' },
            { label: '', value: '' }
          ]);
          const [message, setMessage] = useState(''); // State for custom message box

          // Handles image file uploads and sets the state with the data URL
          const handleImageUpload = (event, setImage) => {
            const file = event.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => setImage(e.target.result);
              reader.readAsDataURL(file);
            }
          };

          // Adds a new empty specification row
          const addSpecification = () => {
            setSpecifications([...specifications, { label: '', value: '' }]);
          };

          // Removes a specification row by index
          const removeSpecification = (index) => {
            if (specifications.length > 1) {
              setSpecifications(specifications.filter((_, i) => i !== index));
            }
          };

          // Updates a specific field (label or value) of a specification row
          const updateSpecification = (index, field, value) => {
            const updated = [...specifications];
            updated[index][field] = value;
            setSpecifications(updated);
          };

          // Handles downloading the catalog as an image (PNG) or PDF
          const handleDownload = async (format) => {
            const catalogElement = document.getElementById('catalog-preview');
            if (!catalogElement) {
              setMessage('Catalog preview element not found.');
              return;
            }

            // Dynamically import html2canvas
            const html2canvas = (await import('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js')).default;

            try {
              const canvas = await html2canvas(catalogElement, {
                backgroundColor: backgroundColor,
                scale: 2, // Increase scale for better resolution
                useCORS: true, // Enable CORS for images if they are from different origins
                allowTaint: true // Allow tainting canvas for cross-origin images (less secure but often needed)
              });

              if (format === 'image') {
                // Download as PNG
                const link = document.createElement('a');
                link.download = 'catalog.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
              } else if (format === 'pdf') {
                // Convert to PDF using jsPDF
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = await import('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');
                const pdf = new jsPDF();

                const imgWidth = 210; // A4 width in mm
                const pageHeight = 295; // A4 height in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                  position = heightLeft - imgHeight;
                  pdf.addPage();
                  pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                  heightLeft -= pageHeight;
                }
                pdf.save('catalog.pdf');
              }
              setMessage('Download successful!');
            } catch (error) {
              console.error('Download failed:', error);
              setMessage('Download failed. Please try again.');
            }
          };

          return (
            <div className="min-h-screen bg-gray-100 p-4 font-inter flex flex-col items-center">
              <h1 className="text-4xl font-bold text-gray-800 mb-8">Catalog Generator</h1>

              {/* Input Panel */}
              <div className="bg-white p-6 rounded-xl shadow-lg w-full max-w-4xl mb-8">
                <h2 className="text-2xl font-semibold text-gray-700 mb-6">Input Information</h2>

                {/* Background Color Picker */}
                <div className="mb-4">
                  <label htmlFor="backgroundColor" className="block text-gray-700 text-sm font-bold mb-2">Background Color</label>
                  <div className="flex items-center space-x-2">
                    <input
                      type="color"
                      id="backgroundColor"
                      value={backgroundColor}
                      onChange={(e) => setBackgroundColor(e.target.value)}
                      className="w-12 h-10 rounded-md border border-gray-300 cursor-pointer"
                    />
                    <input
                      type="text"
                      value={backgroundColor}
                      onChange={(e) => setBackgroundColor(e.target.value)}
                      className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="#ff69b4"
                    />
                  </div>
                </div>

                {/* Layout Selection */}
                <div className="mb-4">
                  <label className="block text-gray-700 text-sm font-bold mb-2">Layout</label>
                  <div className="flex items-center space-x-4">
                    <label className="inline-flex items-center">
                      <input
                        type="radio"
                        name="layout"
                        value="vertical"
                        checked={layout === 'vertical'}
                        onChange={(e) => setLayout(e.target.value)}
                        className="mr-2"
                      />
                      Vertical
                    </label>
                    <label className="inline-flex items-center">
                      <input
                        type="radio"
                        name="layout"
                        value="horizontal"
                        checked={layout === 'horizontal'}
                        onChange={(e) => setLayout(e.target.value)}
                        className="mr-2"
                      />
                      Horizontal
                    </label>
                  </div>
                </div>

                {/* Brand Logo Upload */}
                <div className="mb-4">
                  <label htmlFor="brandLogoUpload" className="block text-gray-700 text-sm font-bold mb-2">Brand Logo</label>
                  <input
                    type="file"
                    accept="image/*"
                    onChange={(e) => handleImageUpload(e, setBrandLogo)}
                    className="hidden"
                    id="brandLogoUpload"
                  />
                  <label
                    htmlFor="brandLogoUpload"
                    className="w-full flex items-center justify-center px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 cursor-pointer"
                  >
                    <Upload className="mr-2" size={20} /> Click to upload Brand Logo
                  </label>
                </div>

                {/* Product Name */}
                <div className="mb-4">
                  <label htmlFor="productName" className="block text-gray-700 text-sm font-bold mb-2">Product Name</label>
                  <input
                    type="text"
                    id="productName"
                    value={productName}
                    onChange={(e) => setProductName(e.target.value)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter product name"
                  />
                </div>

                {/* Model Name */}
                <div className="mb-4">
                  <label htmlFor="modelName" className="block text-gray-700 text-sm font-bold mb-2">Model Name</label>
                  <input
                    type="text"
                    id="modelName"
                    value={modelName}
                    onChange={(e) => setModelName(e.target.value)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter model name"
                  />
                </div>

                {/* Product Image Upload */}
                <div className="mb-4">
                  <label htmlFor="productImageUpload" className="block text-gray-700 text-sm font-bold mb-2">Product Image</label>
                  <input
                    type="file"
                    accept="image/*"
                    onChange={(e) => handleImageUpload(e, setProductImage)}
                    className="hidden"
                    id="productImageUpload"
                  />
                  <label
                    htmlFor="productImageUpload"
                    className="w-full flex items-center justify-center px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 cursor-pointer"
                  >
                    <Upload className="mr-2" size={20} /> Click to upload Product Image
                  </label>
                </div>

                {/* Specifications */}
                <div className="mb-6">
                  <div className="flex justify-between items-center mb-2">
                    <label className="block text-gray-700 text-sm font-bold">Specifications</label>
                    <button
                      onClick={addSpecification}
                      className="px-3 py-1 bg-green-500 text-white rounded-md hover:bg-green-600 flex items-center"
                    >
                      <Plus size={16} className="mr-1" /> Add
                    </button>
                  </div>
                  {specifications.map((spec, index) => (
                    <div key={index} className="flex items-center space-x-2 mb-2">
                      <input
                        type="text"
                        value={spec.label}
                        onChange={(e) => updateSpecification(index, 'label', e.target.value)}
                        className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Label (e.g., Manufacturer)"
                      />
                      <input
                        type="text"
                        value={spec.value}
                        onChange={(e) => updateSpecification(index, 'value', e.target.value)}
                        className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Value (e.g., Qingdao Yingshiyuan)"
                      />
                      <button
                        onClick={() => removeSpecification(index)}
                        className="px-2 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 flex items-center justify-center"
                      >
                        <Minus size={16} />
                      </button>
                    </div>
                  ))}
                </div>

                {/* Download Buttons */}
                <div className="flex flex-col sm:flex-row gap-4">
                  <button
                    onClick={() => handleDownload('image')}
                    className="w-full flex items-center justify-center px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600"
                  >
                    <Download className="mr-2" size={20} /> Download as Image (PNG)
                  </button>
                  <button
                    onClick={() => handleDownload('pdf')}
                    className="w-full flex items-center justify-center px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600"
                  >
                    <Download className="mr-2" size={20} /> Download as PDF
                  </button>
                </div>
              </div>

              {/* Custom Message Box */}
              {message && (
                <div className="fixed bottom-4 right-4 bg-gray-800 text-white p-3 rounded-md shadow-lg z-50">
                  {message}
                  <button
                    onClick={() => setMessage('')}
                    className="ml-4 text-sm font-bold text-gray-400 hover:text-white"
                  >
                    &times;
                  </button>
                </div>
              )}

              {/* Preview Panel */}
              <div className="bg-white p-6 rounded-xl shadow-lg w-full max-w-4xl">
                <h2 className="text-2xl font-semibold text-gray-700 mb-6">Preview</h2>
                <div
                  id="catalog-preview"
                  className="p-8 rounded-lg shadow-inner"
                  style={{ backgroundColor: backgroundColor }}
                >
                  {layout === 'vertical' ? ( // Vertical Layout
                    <>
                      {/* Brand Logo */}
                      <div className="mb-6 text-center">
                        {brandLogo ? (
                          <img src={brandLogo} alt="Brand Logo" className="max-h-24 mx-auto rounded-md shadow" />
                        ) : (
                          <div className="w-32 h-16 bg-gray-300 rounded-md flex items-center justify-center text-gray-600 text-sm mx-auto">
                            Logo
                          </div>
                        )}
                      </div>

                      {/* Product Name */}
                      <h3 className="text-3xl font-bold text-gray-900 mb-2 text-center">{productName || 'Product Name'}</h3>

                      {/* Model Name */}
                      <p className="text-xl text-gray-700 mb-8 text-center">{modelName || 'Model Name'}</p>

                      {/* Product Image and Specifications */}
                      <div className="flex flex-col md:flex-row items-center md:items-start gap-8">
                        {/* Product Image */}
                        <div className="flex-shrink-0 w-full md:w-1/2">
                          {productImage ? (
                            <img src={productImage} alt="Product" className="w-full h-auto rounded-md shadow-lg" />
                          ) : (
                            <div className="w-full h-64 bg-gray-300 rounded-md flex items-center justify-center text-gray-600 text-lg">
                              Product Image
                            </div>
                          )}
                        </div>

                        {/* Specifications */}
                        <div className="flex-grow w-full md:w-1/2">
                          <h4 className="text-2xl font-semibold text-gray-800 mb-4">Specifications</h4>
                          <ul className="space-y-2">
                            {specifications.map((spec, index) => (
                              <li key={index} className="flex justify-between items-center text-gray-700">
                                <span className="font-medium">{spec.label || `Item ${index + 1}`}:</span>
                                <span>{spec.value || 'Value'}</span>
                              </li>
                            ))}
                          </ul>
                        </div>
                      </div>
                    </>
                  ) : ( // Horizontal Layout
                    <div className="flex flex-col md:flex-row gap-8 items-stretch">
                      {/* Left Column: Brand Logo, Product Name, Model Name */}
                      <div className="flex-shrink-0 w-full md:w-1/3 flex flex-col items-center justify-center p-4 bg-gray-50 rounded-lg shadow">
                        <div className="mb-4">
                          {brandLogo ? (
                            <img src={brandLogo} alt="Brand Logo" className="max-h-20 mx-auto rounded-md shadow" />
                          ) : (
                            <div className="w-24 h-12 bg-gray-300 rounded-md flex items-center justify-center text-gray-600 text-xs mx-auto">
                              Logo
                            </div>
                          )}
                        </div>
                        <h3 className="text-2xl font-bold text-gray-900 mb-1 text-center">{productName || 'Product Name'}</h3>
                        <p className="text-lg text-gray-700 text-center">{modelName || 'Model Name'}</p>
                      </div>

                      {/* Middle Column: Product Image */}
                      <div className="flex-shrink-0 w-full md:w-1/3 flex items-center justify-center p-4 bg-gray-50 rounded-lg shadow">
                        {productImage ? (
                          <img src={productImage} alt="Product" className="w-full h-auto rounded-md shadow-lg" />
                        ) : (
                          <div className="w-full h-48 bg-gray-300 rounded-md flex items-center justify-center text-gray-600 text-base">
                            Product Image
                          </div>
                        )}
                      </div>

                      {/* Right Column: Specifications */}
                      <div className="flex-grow w-full md:w-1/3 p-4 bg-gray-50 rounded-lg shadow">
                        <h4 className="text-xl font-semibold text-gray-800 mb-3">Specifications</h4>
                        <ul className="space-y-1">
                          {specifications.map((spec, index) => (
                            <li key={index} className="flex justify-between items-center text-gray-700 text-sm">
                              <span className="font-medium">{spec.label || `Item ${index + 1}`}:</span>
                              <span>{spec.value || 'Value'}</span>
                            </li>
                          ))}
                        </ul>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        };


        // React 앱을 id="root" 엘리먼트에 렌더링합니다.
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(React.createElement(CatalogGenerator));
    </script>
</body>
</html>
